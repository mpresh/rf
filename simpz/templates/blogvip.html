{% extends "event_base.html" %}

	{% block  js_css_include %}
          <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key={{map_key}}" type="text/javascript" > </script> 
	{% endblock %}

{% block title  %}
{{event.name}}
{% endblock %}


{% block content %}
<!-- Content starts here -->
{%if user%}
<!-- check if user logged in -->

  {% if going %}
<!-- check if user is going already -->
                        <div id="greeting">
                                Hi {{user.name}}!
                                <div id="status"><img src="images/gr.png"></div>
                        </div>
                        <div id="invitemsg">See who else is going.</div>
                        <div id="invite-button">
                                <a href="#" id="invite_button" rel="#invite_popup"><img src="images/button.png"></a>
                        </div>

  {% else %}
                        <div id="greeting">
                                Hi {{user.name}}!
                                <div id="status">not yet</div>
                        </div>
                        <div id="invitemsg">There are {{event.num_attendees}} attending. join us</div>

        <input id="going_button" type="submit" class="button" value="Count me In!"> &nbsp; &nbsp;
        <button href='#' id="invite_button" class="button2" rel="#invite_popup">Tell Friends</button>

  {% endif%}
{% else %}
                        <div id="greeting">
                                Hi {{user.name}}!
                                <div id="status"><img src="images/gr.png"></div>
                        </div>
                        <div id="invite-button"><img onClick="location.href='/simpz/login/'" src="images/look/get.png">
                        </div>
                        <div id="invitemsg">Login & see if your friends are going</div>

{% endif%}

<!-- This is the Invite popup code -->
<div id="invite_popup" class="simple_overlay">

    

    <ul class="tabs">
       <li><a href="#">Twitter</a></li>
       <li><a href="#">Facebook</a></li>
       <li><a href="#">Email</a></li>
    </ul>


    <!-- tab "panes" -->
    <div class="panes">
      <div>
        <div class="twitterfriends">
          <div id="tweet_title"><input type="text" id="tweet_text" maxlength="140" size="45"></input><button id="tweet_invite_button">Tweet Invite</button></div>
          <div id="tweet_msg"></div>
	  <a href="#" class="select_all_arrow"><img class="select_all_arrow" src="/simpz/site_media/images/arrow-down.gif"></img></a>
	  <hr  class="horizontal_line "/>
          <div id="twitlist"><img src="/simpz/site_media/images/ajax-loader.gif" /></div>
        </div>
        
        <BR />
        <input id="invite_dm_button" type="submit" class="button" value="Invite my friends" />
      </div>
    
    
      <div>
	<div id="facebookfriends">
	  
	</div>
      </div>
    
      <div>
	<div id="emailfriends">
	  
	</div>
      </div>
    </div>
      
    </div>
    
    
    <BR />
		

<div id="attendees">
		<div id="msg">Current Guest List</div>

		{% for attendee in attendees %} 

		<a href="#">
		<img src="{{attendee.profile_pic}}" /> 
		</a>
		&nbsp;

		{% endfor %}
	</div>

</div>
		
<div id="visual_map" style="width: 416px; height: 307px;" > </div>						
	      
<div id="dets">
	<div id="event-title">{{event.name}}</div>
	<div id="info"><img src="images/map-ico.png"> {{event.venue}}, {{event.venue_address}} <div id="right">{{event.time}} <img src="images/cal-ico.png"></div></div>
	<div id="goog"><img src="images/map.png"></div>
</div>




<script>
$(document).ready(function() {

	$("#invite_popup_close").bind('click', function() {
		$('#invite_popup').hide();
                $('#tweet_msg').html("");
		ajax_loader_image();
	 });


	$("#not_going_button").click(function(){
		$.get('/simpz/ajax/event_not_going/{{event.id}}', function(data) {
			location.reload();
		    });
	    });
			
	$("#going_button").click(function(){
		$.get('/simpz/ajax/event_going/{{event.id}}', function(data) {
			location.reload();
		    });
	    });

       $("#tweet_invite_button").click(function(){
		$.ajax({
                    url: '/simpz/ajax/event_tweet_invite/{{event.id}}', 
                    dataType: "json",
                    data: {data: $("#tweet_text").val(), 
                    invite_url: '{{invite_url}}',
                    invite_id: {{invite_id}}
                          }, 
                    success: function(data){
                        $("#tweet_msg").html("Tweet Sent Succesfully");
                        $("#tweet_text").val(data["msg"]);
	        	     },
                    beforeSend: function() {
                        //$("#tweet_invite_button").attr("disabled","disabled");                               
                        $("#tweet_msg").html("<img width='20' height='20' src='/simpz/site_media/images/ajax-loader.gif' />Sending Tweet<img width='20' height='20' src='/simpz/site_media/images/ajax-loader.gif' />");
                    }
                   });
	    });

	$("#invite_button").overlay(
				    {
					expose: {
					    loadSpeed: 200,
						color: 'gray',
						opacity: 0.8
						},
					onLoad: function(event) {
                                                $("#tweet_msg").html("");
                                                $("#tweet_text").val("TEST: Discounted Invite to my Friends.");
                                                $("#tweet_invite_button").removeAttr("disabled");
						//display_friends_invite();
                                                                                                
					}
				    }); 

        $('#invite_dm_button').click(function() {
            var selected_users = [];

            $("input[name='invitee']").each(function(index) {
                 if ($(this).attr("checked")) { 
                     selected_users.push($(this).val());
                 } 
            });
           
            $.ajax({
                    url: '/simpz/ajax/event_tweet_invite_dm/{{event.id}}', 
                    dataType: "json",
                    data: {data: $("#tweet_text").val(), 
                    invite_url: '{{invite_url}}',
                    invite_id: '{{invite_id}}',
                    invited_friends: selected_users.toString(),
                          }, 
                    success: function(data){
                        $("#tweet_msg").html("Tweets Sent Succesfully");
                        $("#tweet_text").val(data["msg"]);
                        $("#invite_dm_button").removeAttr("disabled");                      
	        	     },
                    beforeSend: function() {
                        $("#invite_dm_button").attr("disabled","disabled");                      
                        $("#tweet_msg").html("<img width='20' height='20' src='/simpz/site_media/images/ajax-loader.gif' />Sending Direct Msg Tweets<img width='20' height='20' src='/simpz/site_media/images/ajax-loader.gif' />");
                    }
                   });
        });
			
    
	$("#visual_map").hide();
	$("#show_map").html("(Show Map)");


	if (GBrowserIsCompatible()) {
	    var map = new GMap2(document.getElementById("visual_map"));
	    map.setCenter(new GLatLng({{event.lat}}, {{event.lng}}), 13);
	    map.setUIToDefault();
	}			


	$("#show_map").click(function() {

		if ($("#visual_img").is(":visible")) {

		    $("#visual_img").hide(500);
			
		    $("#visual_map").show(500, function() {
			   
			    if (GBrowserIsCompatible()) {
				var map = new GMap2(document.getElementById("visual_map"));
				map.setCenter(new GLatLng({{event.lat}}, {{event.lng}}), 13);
				map.setUIToDefault();
			    }
			});
		

		    $("#show_map").html("(Hide Map)");
		}else {
		    $("#visual_img").show(500);
		    $("#visual_map").hide(500);
		    $("#show_map").html("(Show Map)");
		}
	    });
    });

// perform JavaScript after the document is scriptable.
$(function() {
    // setup ul.tabs to work as tabs for each div directly under div.panes
    $("ul.tabs").tabs("div.panes > div");
});


function setup_select_all_button() {
    $("a.select_all_arrow").toggle(function() {
       $(".friend_list_item").each(function(index) {
                $(this).css("background-color", "#FF9933");    
                $(this).find("input[name='invitee']").attr("checked", "yes");
                $(this).find("img.checkbox_invite").attr("src", "/simpz/site_media/images/checkbox_checked.png");
            });
    }, 
    function() {
        $(".friend_list_item").each(function(index) {
                $(this).css("background-color", "#FBF5EF");    
                $(this).find("input[name='invitee']").removeAttr("checked");
                $(this).find("img.checkbox_invite").attr("src", "/simpz/site_media/images/checkbox_unchecked.png");
        });
    });

}

function ajax_loader_image() {
    $('#twitlist').html("<img style='margin-left:275px; margin-top:40px;' width='130' height='130' src='/simpz/site_media/images/ajax-loader.gif' />");
}


function display_friends_invite_twitter() {
            $.ajax({
                    url: '/simpz/ajax/event_friend_not_attendees/{{event.id}}', 
                    dataType: "json",
                    success: function(data){
                               $('#twitlist').html(make_friend_list(data));
                               $('#tweet_msg').html("Invite Your Friends");
                                                             
                               $(".friend_list_item").toggle(function() {
                                   $(this).css("background-color", "#FF9933");    
                                   $(this).hover(function(){
                                         $(this).css("background-color", "#FF9933");
                                   },
                                   function(){
                                         $(this).css("background-color", "#FF9933");
                                   });
                                   $(this).find("input[name='invitee']").attr("checked", "yes");
                                   $(this).find("img.checkbox_invite").attr("src", "/simpz/site_media/images/checkbox_checked.png");
                               }, function() {
                                   $(this).css("background-color", "#fd9");
                                   $(this).hover(function(){
                                         $(this).css("background-color", "#fd9");
                                   },
                                   function(){
                                         $(this).css("background-color", "#FBF5EF");
                                   });

                                   $(this).find("input[name='invitee']").removeAttr("checked");
                                   $(this).find("img.checkbox_invite").attr("src", "/simpz/site_media/images/checkbox_unchecked.png");
                               });
                               setup_select_all_button(); 
	                       
	        	     },
                    beforeSend: function() {
                        $('#tweet_msg').html("Loading Friend Data");
                        ajax_loader_image();
                    }
                   });
 
}

function display_friends_invite_facebook() {
            $.ajax({
                    url: '/simpz/ajax/facebook_friends', 
                    dataType: "json",

                    success: function(data){
                        $('#facebookfriends').html(data.data);
                        //alert(data.data);
	        	     },
                    beforeSend: function() {
                        
                    }
                   });
 
}


$(document).ready(function() {
// background processing
setTimeout ( "display_friends_invite_twitter()", 10 );
setTimeout ( "display_friends_invite_facebook()", 10 );
   
});

</script>
<!-- Content ends here -->
{% endblock %}












