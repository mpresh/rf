
        <div id="ripple-badge">
	    <div id="badge-title">{{campaign.title}}</div>
	    <div id="badge-subtitle">{{campaign.message}}</div>
	    <div id="badge-action">JUST BY <b>Sharing</b> with friends:</div>

         <div id="badge-footer">

	    <div id="facebook-login-share">
		  <div id="fb-root"></div>
                  <script src="http://connect.facebook.net/en_US/all.js"></script>
                  {% if fbuser %}
		      <button id="facebook-share" class="badge-button">
		           <img src="{% url static 'images/facebookShare_icon2.png' %}"/><span>Share</span>
		      </button>
                     <a id="flogout">logout</a>
		  {% else %}
		      <button id="facebook-login" class="badge-button">
		           <img src="{% url static 'images/facebookShare_icon2.png' %}"/><span>Share</span>
		      </button>
                  {% endif %}
	     </div>  

	     <div id="twitter-login-share">
                 {% if user %}
		     <button id="twitter-share" class="badge-button">
		           <img src="{% url static 'images/twitterShare_icon2.png' %}"/><span>Share</span>
		     </button>
                 {% else %}
                     <button onClick="location.href='{% url tauth_login %}?redirectArgs=overlayEQUALStwitter'" 
		     class="badge-button" id="twitter-login">
		         <img src="{% url static 'images/twitterShare_icon2.png' %}" /><span>Share</span>
		     </button>
                 {% endif %}
             </div>
	 </div><!-- badge footer-->
	</div> <!-- badge -->


	<div id="overlay-blogger-login" class="overlay-blogger">

	    <div id="overlay-div-content2-facebook" >
                <div class="overlay-top">
                    {%ifequal campaign.campaign_type "discount" %}
                    <p>Discounts Are Better When You Share Them</p>
                     {% else %}  
                    <p>Share and win, it's that simple</p>
                    {% endifequal %}
                </div>
                <div id="facebook-top-msg">
                     {%ifequal campaign.campaign_type "discount" %}
                     <p>Share to Reveal Discount</p>
                     {% else %}  
                     <p>Share to enter contest</p>
                    {% endifequal %}
		</div>

		<div class="textarea-div">
		     <textarea id="overlay-textarea-facebook">{{campaign.message_share}}</textarea>
		</div>
		<div id="facebook-feed-update" class="share-button"><p>Share</p></div>
	    </div><!-- end overlay-div-content2-facebook -->
	
	    <div id="overlay-div-content2-twitter">
		<div class="overlay-top">
                    {%ifequal campaign.campaign_type "discount" %}
                    <p>Discounts Are Better When You Share Them</p>
                    {% else %}  
                    <p>Share and win, it's that simple</p>
                    {% endifequal %}
                </div>
                
                <div id="twitter-top-msg">
                    {%ifequal campaign.campaign_type "discount" %}
                    <p>Share to Reveal Discount</p>
                    {% else %}  
                    <p>Share to enter contest</p>
                    {% endifequal %}
		</div>

		<div class="textarea-div">
		     <textarea id="overlay-textarea-twitter" >{{campaign.message_share}}</textarea>
		</div>
		<div id="twitter-feed-update" class="share-button"><p>Share</p></div>
	    </div> <!-- end overlay-div-content2-twitter -->

	    <div id="overlay-div-content3" >
		<div class="overlay-top">
                    {%ifequal campaign.campaign_type "discount" %}
                    <p>Discount Code</p>
                    {% else %}
                    <p>Successfully Entered Contest</p>
                    {% endifequal %}
                </div>

                {%ifequal campaign.campaign_type "discount" %}

		<div id="code-msg">Thanks for sharing.<BR> Here is your discount code:</div>
		<div id="code">
		    <p id="discount-code">{{campaign.code}}</p>
		    <div id="d_clip_container" style="position:relative">
		        <button type="button" id="d_clip_button">Copy to Clipboard</button>
		    </div>
		    <span>Redeem Here:</span><a href="{{campaign.url_redeem}}">{{campaign.url_redeem}}</a></font></div>
		{% else %}
                <div id="code-msg">Thanks for sharing.<BR> You have entered raffle:</div>
                <img style="margin: 20px;" id="img-prize" src="{{campaign.url_redeem}}" />

                {% endifequal %}
	    </div><!-- end overlay-div-content3 -->
         </div><!-- end overlay-blogger -->





<script>
// Global vars
var contentView = 0;
var shareLink = '';
var overlayType = 'twitter';

function badge_facebook_login_click() {
  var requiredPerms  = ['publish_stream'];
  FB.login(function(response) {
    if (response.session) {
      var a = response.session;
      var options = { path: '/', expires: 10 };
      $.cookie("uid", a.uid, options);
      $.cookie("session_key", a.session_key, options);
      $.cookie("secret", a.secret, options);
      $.cookie("expires", a.expires, options);
      $.cookie("base_domain", a.base_domain, options);
      $.cookie("access_token", a.access_token, options);
      $.cookie("sig", a.sig, options);

      // make an ajax call here to login to facebook
      $.ajax({
		url: '{% url facebook_callback_ajax %}', 
		dataType: "json",
		data: {},
		success: function(data){
				//alert("REQUEST DONE", data);
                                overlayType = 'facebook';
                                $("#overlay-blogger-login").overlay().load();                                
		},
		beforeSend: function() {
			       //alert("sending feed requesst");
		}
	});
      //var url = "/facebook_callback?redirectArgs=overlayEQUALSfacebook";
      //window.location.href = url;
  } else { FB.logout(function(response) { 
			}); }


      }, {perms: requiredPerms.join(',')}
      );
}

FB.init({appId: '{{facebook_app_id}}', status: true, cookie: true, xfbml: true});


$('#facebook-login').click(function(){
       signinWin = window.open("https://graph.facebook.com/oauth/authorize?client_id={{facebook_api}}&redirect_uri={{redirect_uri}}&display=popup&scope={{scope}}", "SignIn", "width=780,height=410");
       setTimeout(CheckLoginStatus, 2000);
       signinWin.focus();
       return false;
});
function CheckLoginStatus() {
    if (signinWin.closed) {
        alert("I have logged in");
        #window.location.href = "{% url facebook_login_test %}"
   }
    else setTimeout(CheckLoginStatus, 1000);
}

//default usage
$("#overlay-textarea-twitter").charCount();
({
	allowed: 80,		
	warning: 20
});
$("#overlay-textarea-facebook").charCount();
({
	allowed: 80,		
	warning: 20
});



$('#flogout').click(function(){
        $.ajax({ 
                   url: "{% url ajax_facebook_logout %}", 
	           dataType: "json", 
	           data: {},
	           success: function (data) { 
                       $("#flogout").hide();
                   },
	           beforeSend: function() {
                       FB.logout();
                 } 

        }); 
});

function activateCopy() {
    ZeroClipboard.setMoviePath( "http://collectivevip.com{% url static 'javascript/ZeroClipboard.swf' %}" ); 
    var clip = new ZeroClipboard.Client();
    clip.setText( '{{campaign.code}}' );
    clip.glue( 'd_clip_button', 'd_clip_container' );
}

$("#facebook-feed-update").click(function(){
	// Show discount page
	pageOverlay(3, '');
	//activateCopy();
	$.ajax({
		url: '{% url campaign_facebook_update campaign_id=campaign.id %}', 
		dataType: "json",
		data: {message: $("#overlay-textarea-facebook").val(), 
                       shash: "{{shash}}" },

		success: function(data){
                  refreshAttendee(15);
		},
		beforeSend: function() {
                {%ifequal campaign.campaign_type "discount" %} 
                $("#code").showLoading({'afterShow': function(){ setTimeout( "jQuery('#code').hideLoading()", 3000 );}});         
                {% endifequal %}
		}
	});   

});
$("#twitter-feed-update").click(function() { 
        // Show discount page
        pageOverlay(3, '');
	//activateCopy();

	$.ajax({ 
                   url: "{% url campaign_tweet_invite campaign_id=campaign.id %}", 
	           dataType: "json", 
	           data: {message: $("#overlay-textarea-twitter").val(), 
		   shash: "{{shash}}"},
	           success: function (data) {
                                          $.get('{% url campaign_going_twitter campaign_id=campaign.id %}', 
	                                  function(data) { refreshAttendee(15); }); },
	           beforeSend: function() { 
                {%ifequal campaign.campaign_type "discount" %} 
                         $("#code").showLoading({'afterShow': function(){ setTimeout( "jQuery('#code').hideLoading()", 3000 );}});         
                {% endifequal %}
                 } 

    }); 
});
$("#overlay-blogger-login").overlay({
	expose: {
		loadSpeed: 100,
		color: '#666',
		opacity: 0.8
	},
	onLoad: function(event) {
                // Which page to start on?
		// if twitter user logged in, show twitter page
		{% if user and overlayTwitter %}
		    pageOverlay(2, 'twitter');
		{% else %} 	
	
		    // if fbuser logged in
		    {% if fbuser and overlayFacebook %}
		        pageOverlay(2, 'facebook');
		    {% else %} 
	
		        // show first view with facebook and twitter login buttons
		        {% if not user and not fbuser %}
		            pageOverlay(1, '');
		        {% else %} 	
		        
		            // if fbuser logged in
		            {% if fbuser %}
		                pageOverlay(2, 'facebook');
		            {% else %} 	
		            
		                // if fbuser logged in
		                {% if user  %}
		                pageOverlay(2, 'twitter');
		                {% endif %}
		            {% endif %}
		        {% endif %}
		    {% endif %}
		{% endif %}
            
		if (shareLink == 'facebook') {
		    pageOverlay(2, 'facebook');
		    shareLink = '';
		}
		if (shareLink == 'twitter') {
		    pageOverlay(2, 'twitter');
		    shareLink = '';
		}

	},
	top: 170,
	left: 220
});
function pageOverlay(page, type){
    type = overlayType;
    switch(page) 
    {
    case 1:
	contentView = 1;
        $('#overlay-div-content2-facebook').hide();
        $('#overlay-div-content2-twitter').hide();
        $('#overlay-div-content3').show();
	break;
    case 2:
        contentView = 2;
	if (type == 'facebook') {
	    $('#overlay-div-content2-facebook').show();
	    $('#overlay-div-content2-twitter').hide();
	    $('#overlay-div-content3').hide();
	} else {
	    $('#overlay-div-content2-facebook').hide();
	    $('#overlay-div-content2-twitter').show();
	    $('#overlay-div-content3').hide();
	}
	break;
    case 3:
        contentView = 3;
        $('#overlay-div-content2-facebook').hide();
        $('#overlay-div-content2-twitter').hide();
        $('#overlay-div-content3').show();
	break;
    default:
        break;
    }
}
$('#facebook-share').click(function(){
    shareLink = 'facebook';
    overlayType = "facebook";
    $("#overlay-blogger-login").overlay().load();
});

$('#twitter-share').click(function(){
    overlayType = "twitter";
    shareLink = 'twitter';
    $("#overlay-blogger-login").overlay().load();
});


</script>

<style type="text/css">

div#overlay-div-content2-twitter {
    display: none;
}

div#overlay-div-content2-facebook {
    display: none;
}

div#overlay-div-content3 {
    display: none;
}




div#badge-title {
    font-size: 40px;
    color: #0E2F36;
    margin: 10px;
    text-align: left;
}

div#badge-subtitle {
    font-size: 20px;
    color: #5CA3B2;
    color: #0E2F36;
    margin: 10px 20px 40px 0px;
    text-align: right;
}

div#badge-action {
    font-size: 24px;
    color: red;
}

div#badge-footer {
   width: 100%;
   height: 50px;
   background-color: white;
   position: absolute;
   bottom: 0px;
   -webkit-border-radius: 0px 0px 10px 10px;
}

div#facebook-login-share {
    float: left;
    margin: 5px 0px 0px 80px;
    cursor: pointer; 
}

div#twitter-login-share {
    float: right;
    margin: 5px 80px 0px 0px;
    cursor: pointer;
}

div#ripple-badge {
        position: relative;
        
	box-shadow: 0 0 10px #000000;
	
        -moz-border-radius: 20px;
        -moz-box-shadow: 0 0 10px #000000;

	-webkit-border-radius: 10px 10px 10px 10px;
	-webkit-box-shadow: 3px 3px 10px #000000;
	
	
	text-align: center;
	font-size: 16px;
	font-weight: bold;

        #background-color: #EFFBFB;
	background-color: #F2F2F2;
	float: left;
	width: 469px;
	height: 220px;

	font-size: 20px;
	color: red;
}

.overlay-top p {
    margin: 0px;
}
</style>
