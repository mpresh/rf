
        <div id="ripple-badge">
	    <div id="badge-title">{{campaign.title}}</div>
	    <div id="badge-subtitle">{{campaign.message}}</div>
	    <div id="badge-action">JUST BY <b>Sharing</b> with friends:</div>

         <div id="badge-footer">

	    <div id="facebook-login-share">
		  <div id="fb-root"></div>
                  <script src="http://connect.facebook.net/en_US/all.js"></script>
           
                    <div id="div-facebook-logged-in" style="display:none; cursor:default;">
		      <button id="facebook-share" class="badge-button" style="cursor: pointer;">
		           <img src="{{host}}{% url static 'images/facebookShare_icon2.png' %}"/><span>Share</span>
		      </button>
                      <a id="flogout" style="cursor: pointer; color: gray; font-size: 12px;">logout</a>
                    </div>

                    <div id="div-facebook-logged-out" style="display=none;cursor:default;">
		      <button id="facebook-login" class="badge-button" style="cursor: pointer;">
		           <img src="{{host}}{% url static 'images/facebookShare_icon2.png' %}"/><span>Share</span>
		      </button>
		      <span style="color: gray; font-size: 12px;">logged out</span>
                    </div>
	     </div>  

	     <div id="twitter-login-share">
                  <div id="div-twitter-logged-in" style="display:none;cursor:default;">
		     <button id="twitter-share" class="badge-button" style="cursor: pointer;">
		           <img src="{{host}}{% url static 'images/twitterShare_icon2.png' %}"/><span>Share</span>
		     </button>
                      <a id="tlogout" style="cursor: pointer; color: gray; font-size: 12px;">logout</a>
		  </div>
		  <div id="div-twitter-logged-out" style="display=none;cursor:default;">
                     <button id="twitter-login" class="badge-button"  style="cursor: pointer;">
		         <img src="{{host}}{% url static 'images/twitterShare_icon2.png' %}" /><span>Share</span>
		     </button>
		     <span style="color: gray; font-size: 12px;">logged out</span>
		  </div>
             </div>
	 </div><!-- badge footer-->
	</div> <!-- badge -->
	{% if user %}
<script>
    $("#div-twitter-logged-in").show();
    $("#div-twitter-logged-out").hide();
</script>
	{% else %}
<script>
    $("#div-twitter-logged-out").show();
    $("#div-twitter-logged-in").hide();
</script>
       {% endif %}
	<div id="overlay-blogger-login" class="overlay-blogger">

	    <div id="overlay-div-content2-facebook" >
                <div class="overlay-top">
                    {%ifequal campaign.campaign_type "discount" %}
                    <p>Discounts Are Better When You Share Them</p>
                     {% else %}  
                    <p>Share and win, it's that simple</p>
                    {% endifequal %}
                </div>
                <div id="facebook-top-msg">
                     {%ifequal campaign.campaign_type "discount" %}
                     <p>Share to Reveal Discount</p>
                     {% else %}  
                     <p>Share to enter contest</p>
                    {% endifequal %}
		</div>

		<div class="textarea-div">
		     <textarea id="overlay-textarea-facebook">{{campaign.message_share}}</textarea>
		</div>
		<div id="facebook-feed-update" class="share-button"><p>Share</p></div>
	    </div><!-- end overlay-div-content2-facebook -->
	
	    <div id="overlay-div-content2-twitter">
		<div class="overlay-top">
                    {%ifequal campaign.campaign_type "discount" %}
                    <p>Discounts Are Better When You Share Them</p>
                    {% else %}  
                    <p>Share and win, it's that simple</p>
                    {% endifequal %}
                </div>
                
                <div id="twitter-top-msg">
                    {%ifequal campaign.campaign_type "discount" %}
                    <p>Share to Reveal Discount</p>
                    {% else %}  
                    <p>Share to enter contest</p>
                    {% endifequal %}
		</div>

		<div class="textarea-div">
		     <textarea id="overlay-textarea-twitter" >{{campaign.message_share}}</textarea>
		</div>
		<div id="twitter-feed-update" class="share-button"><p>Share</p></div>
	    </div> <!-- end overlay-div-content2-twitter -->

	    <div id="overlay-div-content3" >
		<div class="overlay-top">
                    {%ifequal campaign.campaign_type "discount" %}
                    <p>Discount Code</p>
                    {% else %}
                    <p>Successfully Entered Contest</p>
                    {% endifequal %}
                </div>

                {%ifequal campaign.campaign_type "discount" %}

		<div id="code-msg">Thanks for sharing.<BR> Here is your discount code:</div>
		<div id="code">
		    <p id="discount-code">{{campaign.code}}</p>
		    <div id="d_clip_container" style="position:relative">
		        <button type="button" id="d_clip_button">Copy to Clipboard</button>
		    </div>
		    <span>Redeem Here:</span><a href="{{campaign.url_redeem}}">{{campaign.url_redeem}}</a></font></div>
		{% else %}
                <div id="code-msg">Thanks for sharing.<BR> You have entered raffle:</div>
                <img style="margin: 20px;" id="img-prize" src="{{campaign.url_redeem}}" />

                {% endifequal %}
	    </div><!-- end overlay-div-content3 -->
         </div><!-- end overlay-blogger -->





<script>
// Global vars
var contentView = 0;
var shareLink = '';
var overlayType = 'twitter';

FB.init({appId: '{{facebook_app_id}}', status: true, cookie: true, xfbml: true});

FB.getLoginStatus(function(response) {
  if (response.session) {
    // logged in and connected user, someone you know
    $("#div-facebook-logged-in").show();
    $("#div-facebook-logged-out").hide();

    // if the user is logged in but has no fbuser, get it with ajax
    $.ajax({ 
                   url: "{{host}}{% url ajax_facebook_sync_server %}", 
    	           dataType: "json", 
    	           data: {uid : response.session.uid,
                          access_token : response.session.access_token},
    	           success: function (data){ 
                   },
    	           beforeSend: function() {
                 } 
    
        });

  } else {
    // no user session available, someone you dont know
    $("#div-facebook-logged-out").show();
    $("#div-facebook-logged-in").hide();
  }
});

/////////// twitter login ////////////////
$('#twitter-login').click(function(){
       signinWin = window.open("{{host}}{% url tauth_login %}", "SignIn", "width=780,height=410");
       setTimeout(CheckLoginStatusTwitter, 2000);
       signinWin.focus();
       return false;
});
function CheckLoginStatusTwitter() {
    if (signinWin.closed) {
            $("#div-twitter-logged-in").show();
            $("#div-twitter-logged-out").hide();
            shareLink = 'twitter';
            overlayType = "twitter";
            $("#overlay-blogger-login").overlay().load();
   }
    else setTimeout(CheckLoginStatusTwitter, 1000);
}

///////////// facebook login //////////////
$('#facebook-login').click(function(){
       signinWin = window.open("https://graph.facebook.com/oauth/authorize?client_id={{facebook_api}}&redirect_uri={{redirect_uri}}&display=popup&scope={{scope}}", "SignIn", "width=780,height=410");
       setTimeout(CheckLoginStatusFacebook, 2000);
       signinWin.focus();
       return false;
});
function CheckLoginStatusFacebook() {
    if (signinWin.closed) {
            $("#div-facebook-logged-in").show();
            $("#div-facebook-logged-out").hide();
            shareLink = 'facebook';
            overlayType = "facebook";
            $("#overlay-blogger-login").overlay().load();
   }
    else setTimeout(CheckLoginStatusFacebook, 1000);
}

//default usage
$("#overlay-textarea-twitter").charCount();
({
	allowed: 80,		
	warning: 20
});
$("#overlay-textarea-facebook").charCount();
({
	allowed: 80,		
	warning: 20
});



$('#flogout').click(function(){
        $.ajax({ 
                   url: "{{host}}{% url ajax_facebook_logout %}", 
	           dataType: "json", 
	           data: {},
	           success: function (data) { 
                       $("#div-facebook-logged-out").show();
                       $("#div-facebook-logged-in").hide();
                   },
	           beforeSend: function() {
       
                       var options  = { path: '/', expires: -1 };
	               $.cookie("uid", null, options);
	               $.cookie("session_key", null, options);
	               $.cookie("secret", null, options);
	               $.cookie("expires", null, options);
	               $.cookie("base_domain", null, options);
	               $.cookie("access_token", null, options);
	               $.cookie("sig", null, options);
                       FB.logout();

                 } 

        }); 
});

$('#tlogout').click(function(){
        $.ajax({ 
                   url: "{{host}}{% url tauth_logout %}", 
	           dataType: "json", 
	           data: {},
	           success: function (data) { 
                       
                   },
	           beforeSend: function() {
       $("#div-twitter-logged-out").show();
                       $("#div-twitter-logged-in").hide();
                 } 

        }); 
});


function activateCopy() {
    ZeroClipboard.setMoviePath( "{{host}}{% url static 'javascript/ZeroClipboard.swf' %}" ); 
    var clip = new ZeroClipboard.Client();
    clip.setText( '{{campaign.code}}' );
    clip.glue( 'd_clip_button', 'd_clip_container' );
}

$("#facebook-feed-update").click(function(){
	// Show discount page
	pageOverlay(3, '');
	//activateCopy();
	$.ajax({
		url: '{{host}}{% url campaign_facebook_update campaign_id=campaign.id %}', 
		dataType: "json",
		data: {message: $("#overlay-textarea-facebook").val(), 
                       shash: "{{shash}}" },

		success: function(data){
                  refreshAttendee(15);
		},
		beforeSend: function() {
                {%ifequal campaign.campaign_type "discount" %} 
                $("#code").showLoading({'afterShow': function(){ setTimeout( "jQuery('#code').hideLoading()", 3000 );}});         
                {% endifequal %}
		}
	});   

});
$("#twitter-feed-update").click(function() { 
        // Show discount page
        pageOverlay(3, '');
	//activateCopy();

	$.ajax({ 
                   url: "{{host}}{% url campaign_tweet_invite campaign_id=campaign.id %}", 
	           dataType: "json", 
	           data: {message: $("#overlay-textarea-twitter").val(), 
		   shash: "{{shash}}"},
	           success: function (data) {
                                          $.get('{{host}}{% url campaign_going_twitter campaign_id=campaign.id %}', 
	                                  function(data) { refreshAttendee(15); }); },
	           beforeSend: function() { 
                {%ifequal campaign.campaign_type "discount" %} 
                         $("#code").showLoading({'afterShow': function(){ setTimeout( "jQuery('#code').hideLoading()", 3000 );}});         
                {% endifequal %}
                 } 

    }); 
});
$("#overlay-blogger-login").overlay({
	expose: {
		loadSpeed: 100,
		color: '#666',
		opacity: 0.8
	},
	onLoad: function(event) {
                // Which page to start on?
		// if twitter user logged in, show twitter page
		{% if user and overlayTwitter %}
		    pageOverlay(2, 'twitter');
		{% else %} 	
	
		    // if fbuser logged in
		    {% if fbuser and overlayFacebook %}
		        pageOverlay(2, 'facebook');
		    {% else %} 
	
		        // show first view with facebook and twitter login buttons
		        {% if not user and not fbuser %}
		            pageOverlay(1, '');
		        {% else %} 	
		        
		            // if fbuser logged in
		            {% if fbuser %}
		                pageOverlay(2, 'facebook');
		            {% else %} 	
		            
		                // if fbuser logged in
		                {% if user  %}
		                pageOverlay(2, 'twitter');
		                {% endif %}
		            {% endif %}
		        {% endif %}
		    {% endif %}
		{% endif %}
            
		if (shareLink == 'facebook') {
		    pageOverlay(2, 'facebook');
		    shareLink = '';
		}
		if (shareLink == 'twitter') {
		    pageOverlay(2, 'twitter');
		    shareLink = '';
		}

	},
	top: 170,
	left: 220
});
function pageOverlay(page, type){
    type = overlayType;
    switch(page) 
    {
    case 1:
	contentView = 1;
        $('#overlay-div-content2-facebook').hide();
        $('#overlay-div-content2-twitter').hide();
        $('#overlay-div-content3').show();
	break;
    case 2:
        contentView = 2;
	if (type == 'facebook') {
	    $('#overlay-div-content2-facebook').show();
	    $('#overlay-div-content2-twitter').hide();
	    $('#overlay-div-content3').hide();
	} else {
	    $('#overlay-div-content2-facebook').hide();
	    $('#overlay-div-content2-twitter').show();
	    $('#overlay-div-content3').hide();
	}
	break;
    case 3:
        contentView = 3;
        $('#overlay-div-content2-facebook').hide();
        $('#overlay-div-content2-twitter').hide();
        $('#overlay-div-content3').show();
	break;
    default:
        break;
    }
}
$('#facebook-share').click(function(){
    shareLink = 'facebook';
    overlayType = "facebook";
    $("#overlay-blogger-login").overlay().load();
});

$('#twitter-share').click(function(){
    overlayType = "twitter";
    shareLink = 'twitter';
    $("#overlay-blogger-login").overlay().load();
});


</script>

<style type="text/css">

div#overlay-div-content2-twitter {
    display: none;
}

div#overlay-div-content2-facebook {
    display: none;
}

div#overlay-div-content3 {
    display: none;
}




div#badge-title {
    font-size: 40px;
    color: #0E2F36;
    margin: 10px;
    text-align: left;
}

div#badge-subtitle {
    font-size: 20px;
    color: #5CA3B2;
    color: #0E2F36;
    margin: 10px 20px 40px 0px;
    text-align: right;
}

div#badge-action {
    font-size: 24px;
    color: red;
}

div#badge-footer {
   width: 100%;
   height: 50px;
   background-color: white;
   position: absolute;
   bottom: 0px;
   -webkit-border-radius: 0px 0px 10px 10px;
}

div#facebook-login-share {
    float: left;
    margin: 5px 0px 0px 80px;
    cursor: pointer; 
}

div#twitter-login-share {
    float: right;
    margin: 5px 80px 0px 0px;
    cursor: pointer;
}

div#ripple-badge {
        position: relative;
        
	box-shadow: 0 0 10px #000000;
	
        -moz-border-radius: 20px;
        -moz-box-shadow: 0 0 10px #000000;

	-webkit-border-radius: 10px 10px 10px 10px;
	-webkit-box-shadow: 3px 3px 10px #000000;
	
	
	text-align: center;
	font-size: 16px;
	font-weight: bold;

        #background-color: #EFFBFB;
	background-color: #F2F2F2;
	float: left;
	width: 469px;
	height: 220px;

	font-size: 20px;
	color: red;
}

.overlay-top p {
    margin: 0px;
}
</style>
