{% extends "event_base.html" %}

{% block  js_css_include %}
<!--<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key={{map_key}}" type="text/javascript" > </script> -->
<script type="text/javascript" src="{% url static 'javascript/jquery.cookie.js' %}" ></script>
<script type="text/javascript" src="{% url static 'javascript/charCount.js' %}" ></script>
<link rel="stylesheet" href="{% url static 'css/overlay.css' %}" type="text/css" >
{% endblock %}


{% block title  %}
{{event.name}}
{% endblock %}


{% block content %}
<!-- Content starts here -->



<div id="greeting">
	John's offer to you and your friends:
	<div id="status"></div>
</div>


<div id="invite-button">
	<a href="" id="invite_button" rel="#overlay-blogger-login">Share this to get your discount</a>
</div>


<div id="invitemsg">20% OFF ADMISSION TO BLOG WORLD</div>

<div id="overlay-blogger-login" class="overlay-blogger">

	<div id="overlay-div-content1">
		<div class="overlay-top">
			<img src="{% url static 'images/step1-msg.png' %}">
		</div>
		
		<div id="pick-msg">To get your discount share John's offer with your friends on Facebook or Twitter, choose one:</div>
		<div class="overlay-bot">
			<div id="previous-grey"><img src="{% url static 'images/previous-grey.png' %}"></div>
			<div id="invite-progress"><img src="{% url static 'images/step1.png' %}"></div>
			<div id="next-grey"><img src="{% url static 'images/next-grey.png' %}"></div>
		</div>
		<BR /><BR />

		<div id="overlay-div-facebook-login">
			<script src="http://connect.facebook.net/en_US/all.js"></script>
			
			<div id="fb-root"></div>
			<!--<button id="status_button">STATUS</button>-->
			{% if fbuser %}
			<br/>Facebook<br/>
			<!--<button class="logoutnow">LOGOUT</button>-->
			<fb:profile-pic id="facebook-profile-image" height="45px" width="45px" uid={{fbuser.facebook_id}} linked="false" ></fb:profile-pic> 
			<br/>
			<div class="logoutnow" href="">logout from facebook</div>
			{% else %}
			<img id="facebook-login" src="{% url static 'images/facebook-button.png' %}"/>
			{% endif %}
		</div>

		<div id="overlay-div-twitter-login">

			{% if user %}
			<br/>Twitter<br />
			<img id="twitter-profile-image" src="{{user.profile_pic}}" />
			<br/>
			<a href="{% url tauth_logout %}?redirectArgs=overlayEQUALStrue">logout from twitter</a>
			{% else %}
			<a href="{% url tauth_login %}?redirectArgs=overlayEQUALStrue"><img id="twitter-login" src="{% url static 'images/twitter-button.png' %}" /></a><br/><br/>
			{% endif %}
		</div>

	</div>

	<div id="overlay-div-content2-facebook" >
		<div class="overlay-top">
			<img src="{% url static 'images/step2-msg.png' %} ">
		</div>
		<div class="overlay-bot">
			<div id="previous" class="previous"><img src="{% url static 'images/previous.png' %}"></div>
			<div id="invite-progress"><img src="{% url static 'images/step2.png' %}"></div>
			{%if fbuser %}
			<!--<img id="facebook-feed-update" src="{%url static 'images/facebook-sinvite.png' %}">-->
			<!--FB Back Button-->
			<!--<div id="facebook-div-back"><img src="{% url static 'images/back.png' %}" id="facebook-back"></div>-->
			<div id="facebook-div-feed-update"><img src="{% url static 'images/share.png' %}" id="facebook-feed-update"></div>
			{% endif %}
		</div>
		<div id="facebook-top-msg">
			<img src="{% url static 'images/facebook-share-msg.png' %}">
		</div>
		<textarea id="overlay-textarea-facebook">Join me at BlogWorld in Las Vegas, Oct 14-16. Use my 20% off coupon.</textarea>
	</div>
	
	<div id="overlay-div-content2-twitter">
		<div class="overlay-top">
			<img src="{% url static 'images/step2-msg.png' %}">  
		</div>
		<div class="overlay-bot">
			<div id="previous" class="previous"><img src="{% url static 'images/previous.png' %}"></div>
			<div id="invite-progress"><img src="{% url static 'images/step2.png' %}"></div>
			<div id="twitter-div-feed-update"><img src="{% url static 'images/share.png' %}" id="twitter-feed-update"></div>
		</div>
		<div id="twitter-top-msg">
			<img src="{% url static 'images/twitter-share-msg.png' %}">
		</div>
		<textarea id="overlay-textarea-twitter" >Join me at BlogWorld in Las Vegas, Oct 14-16. Use my 20% off coupon.</textarea>
	</div>
	<div id="overlay-div-content3" >

		<div class="overlay-top"><img src="{% url static 'images/step3-msg.png' %}">  

		</div>
		<div class="overlay-bot">
			<div id="previous" class="previous">
				<img src="{% url static 'images/previous.png' %}">
			</div>
			<div id="invite-progress"><ul><img src="{% url static 'images/step3.png' %}"></div>
			<div id="okay"><img src="{% url static 'images/done.png' %}"></div>
		</div>
		
			<BR /><BR />
			<div id="code-msg">Thanks! You've shared your discount with your friends.<BR><BR>
			Hereâ€™s your discount code:
			</div>      	
			
			<div id="code"><p>JOHNCHOW1</p></div>

	</div>

</div>



<div id="dets"> 
	<div id="event-title">BlogWorld 2010 Panel Spotlight</div>
	<div id="detsbg">
		<div id="info">Blogging Super Panel Live Feedback</div> 
		<div id="goog"><img src="{% url static 'images/speakers.png' %}"></div>
		<p>Is your blog optimizing its potential to make money? Find out! This panel of the top money making bloggers of all time will spend a few hours reviewing your blogs live. So get there early and step up to the mic and be ready to have your blog picked apart by the pros who know.<br><br>
			John Chow, JohnChow.com<br>
			Darren Rowse, Problogger.com<br>
			Jeremy Shoemaker, ShoeMoney.com<br>
			Brian Clark, Copyblogger.com<br>
			Zac Johnson, ZacJohnson.com
		</p>
		<div id="blogworld"><img src="{% url static 'images/blogworld.png' %}"></div>
	</div>
	<div id="detsfooter"></div>
</div> 
<div id="eventinfo"><b>Exhibits:</b> Oct 15-16 | <b>Conference:</b> Oct 14-16<br>Mandalay Bay Convention Center | Las Vegas, Nevada</div>
<div id="attendees">
	<div id="msg">Interested Guests</div>


	<br/><br/><br/><br/><br/><br/>
	<div id="attendees_thumbs">
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		{% for attendee in attendees %} 

		<a href="">
			<img src="{{attendee.profile_pic}}" /> 
		</a>
		&nbsp;

		{% endfor %}
	</div>
</div>

</div>


<!--	
<div id="visual_map" style="width: 416px; height: 307px;" > </div>						

<div id="dets">
<div id="event-title">{{event.name}}</div>
<div id="info"><img src="images/map-ico.png"> {{event.venue}}, {{event.venue_address}} <div id="right">{{event.time}} <img src="images/cal-ico.png"></div></div>
<div id="goog"><img src="images/map.png"></div>
</div>

-->

<script>
$(document).ready(function() {
        var contentView = 0;

	$("#invite_button").overlay(
		{
			expose: {
				loadSpeed: 200,
				color: 'gray',
				opacity: 0.8
			},
			onLoad: function(event) {
				// show first view with facebook and twitter login buttons
				{% if not user and not fbuser %}
                                    contentView = 1;
				    $('#overlay-div-content1').show(); 
				    $('#overlay-div-content2-facebook').hide(); 
				    $('#overlay-div-content2-twitter').hide();
				    $('#overlay-div-content3').hide();
				{% else %} 	
                                
                                // if twitter user logged in, show twitter page
                                {% if user %}
                                    contentView = 2;
				    $('#overlay-div-content1').hide(); 
			            $('#overlay-div-content2-facebook').hide(); 
				    $('#overlay-div-content2-twitter').show();
			            $('#overlay-div-content3').hide();
				{% else %} 	

                                // if fbuser logged in
                                {% if fbuser %}
                                    contentView = 2;
				    $('#overlay-div-content1').hide(); 
			            $('#overlay-div-content2-facebook').show(); 
			            $('#overlay-div-content2-twitter').hide();
			            $('#overlay-div-content3').hide();	
				{% endif %}
				{% endif %}
  		                {% endif %}
			},
			top: 200,
			left: 200,
		});

                $('#facebook-profile-image').click(function(){
                                    contentView = 2;
				    $('#overlay-div-content1').hide(); 
			            $('#overlay-div-content2-facebook').show(); 
				    $('#overlay-div-content2-twitter').hide();
			            $('#overlay-div-content3').hide();
                });

                $('#twitter-profile-image').click(function(){
                                    contentView = 2;
				    $('#overlay-div-content1').hide(); 
			            $('#overlay-div-content2-facebook').hide(); 
				    $('#overlay-div-content2-twitter').show();
			            $('#overlay-div-content3').hide();
                });

                $('.previous').click(function(){
                                    if (contentView == 2){
                               
                                        contentView = 1;
                                        $('#overlay-div-content1').show();  
				        $('#overlay-div-content2-facebook').hide(); 
				        $('#overlay-div-content2-twitter').hide();
				        $('#overlay-div-content3').hide();
                                        
                                    }
                                    else if (contentView == 3) {
                               {% if user %}
                                    contentView = 2;
				    $('#overlay-div-content1').hide(); 
			            $('#overlay-div-content2-facebook').hide(); 
				    $('#overlay-div-content2-twitter').show();
			            $('#overlay-div-content3').hide();
				{% else %} 	

                                // if fbuser logged in
                                {% if fbuser %}
                                    contentView = 2;
				    $('#overlay-div-content1').hide(); 
			            $('#overlay-div-content2-facebook').show(); 
			            $('#overlay-div-content2-twitter').hide();
			            $('#overlay-div-content3').hide();	
				{% endif %}
				{% endif %}
                                    }
                });

		{% if overlay %}
	
		$("#invite_button").overlay().load();
		
		{% endif %}

		FB.init({appId: '{{fbappid}}', status: true, cookie: true, xfbml: true});

		$("#feed").click(function(){
			$.ajax({
				url: '{% url facebook_update_feed %}', 
				dataType: "json",
				data: {},
				success: function(data){
					//alert("REQUEST DONE", data);
				},
				beforeSend: function() {
					//alert("sending feed request");
				}
			});
		});
		$("#message").click(function(){
			$.ajax({
				url: '{% url facebook_message %}', 
				dataType: "json",
				data: {},
				success: function(data){
					//alert("REQUEST DONE", data);
				},
				beforeSend: function() {
					//alert("sending message");
				}
			});
		});

		$("#twitter-feed-update").click(function(){
                        contentView = 3;
			$('#overlay-div-content1').hide(); 
			$('#overlay-div-content2-facebook').hide();	 
			$('#overlay-div-content2-twitter').hide();
			$('#overlay-div-content3').show();
 
			$.ajax({
				url: '{% url event_tweet_invite event_id=event.id %}', 
				dataType: "json",
				data: {message: $("#overlay-textarea-twitter").val(), 
				shash: "{{hash}}",
			}, 
			success: function(data){
				$.get('{% url event_going event_id=event.id %}', function(data) {
                                     refreshAttendee();
				});
			},
			beforeSend: function() {
			}
		});
	});

	$("#facebook-feed-update").click(function(){
                contentView = 3;
		$('#overlay-div-content1').hide(); 
		$('#overlay-div-content2-facebook').hide();	 
		$('#overlay-div-content2-twitter').hide();
		$('#overlay-div-content3').show();

		$.ajax({
			url: '{% url event_facebook_update event_id=event.id %}', 
			dataType: "json",
			data: {message: $("#overlay-textarea-facebook").val(), shash: "{{shash}}" },

			success: function(data){
                           //alert("msg sent");
			},
			beforeSend: function() {
			   //alert("sending feed request");
			}
		});   

	});

	$("#status_button").click(function(){
		FB.getLoginStatus(function(response) {
			//alert("HAHA" + response + inspect(response));
			if (response.session) {
				// logged in and connected user, someone you know
				alert("logged in ");
			} else {
				// no user session available, someone you dont know
				alert("logged out");
			}
		});
	});

	var requiredPerms = ['email','user_about_me','user_birthday','user_website', 'publish_stream'];
	$('#facebook-login').click(function(){
	var fbcheck = "{{fbuser}}";
        FB.getLoginStatus(function(response) {
        if (response.session) {
           // logged in and connected user, someone you know
           //alert("LOGGED IN");
	   if (fbcheck == "") {
	        FB.logout(function(response) { 
                        //window.location.href = "{% url facebook_logout_callback %}?redirectArgs=overlayEQUALStrue";
		});
            }
        } else {
           // no user session available, someone you dont know
          //alert("LOGGED OUT");
          facebook_login_click();
        }

      });
	});


	$('.logoutnow').click(function() {
		var options = { path: '/', expires: -1 };
		$.cookie("uid", null, options);
		$.cookie("session_key", null, options);
		$.cookie("secret", null, options);
		$.cookie("expires", null, options);
		$.cookie("base_domain", null, options);
		$.cookie("access_token", null, options);
		$.cookie("sig", null, options);

        FB.getLoginStatus(function(response) {
        	if (response.session) {	
				FB.logout(function(response) { 
                       //alert("facebook logout refresh");
					//$.get('{% url facebook_logout_callback %}', function(data) {
						//	$("#overlay-div-facebook-login").html("<a href='#'><img id='facebook-login' src='{%url static 'images/Facebook-Button.png' %}/></a>");
						//	$("#overlay-div-facebook-login").click(function(){
						//		facebook_login_click(requirePerms);
						//	});
                        
             			window.location.href = "{% url facebook_logout_callback %}?redirectArgs=overlayEQUALStrue";
						//});
					});
				}
			else{	
                window.location.href = "{% url facebook_logout_callback %}?redirectArgs=overlayEQUALStrue";
            }
        });
	});

	$("#invite_popup_close").bind('click', function() {
		$('#invite_popup').hide();
		$('#tweet_msg').html("");
		ajax_loader_image();
	});

    $("#okay").click(function(){
	   $("#invite_button").overlay().close();
    });

	$("#not_going_button").click(function(){
		$.get('{%url event_not_going event_id=event.id %}', function(data) {
			location.reload();
		});
	});

	$("#going_button").click(function(){
		$.get('{%url event_going event_id=event.id %}', function(data) {
			location.reload();
		});
	});

	$("#tweet_invite_button").click(function(){
		$.ajax({
			url: '{% url event_tweet_invite event_id=event.id %}', 
			dataType: "json",
			data: {data: $("#tweet_text").val(), 
			invite_url: '{{invite_url}}'
			//invite_id: {{invite_id}}
		}, 
		success: function(data){
			$("#tweet_msg").html("Tweet Sent Succesfully");
			$("#tweet_text").val(data["msg"]);
		},
		beforeSend: function() {
			//$("#tweet_invite_button").attr("disabled","disabled");                               
			$("#tweet_msg").html("<img width='20' height='20' src='{% url static 'images/ajax-loader.gif' %} />Sending Tweet<img width='20' height='20' src='{% url static 'images/ajax-loader.gif' %}' />");
		}
	});

     });


     $('#invite_dm_button').click(function() {
	var selected_users = [];

	$("input[name='invitee']").each(function(index) {
		if ($(this).attr("checked")) { 
			selected_users.push($(this).val());
		} 
	});

	$.ajax({
		url: '{% url event_tweet_invite_dm event_id=event.id %}', 
		dataType: "json",
		data: {data: $("#tweet_text").val(), 
		invite_url: '{{invite_url}}',
		invite_id: '{{invite_id}}',
		invited_friends: selected_users.toString(),
	        }, 
	success: function(data){
		$("#tweet_msg").html("Tweets Sent Succesfully");
		$("#tweet_text").val(data["msg"]);
		$("#invite_dm_button").removeAttr("disabled");                      
	},
	beforeSend: function() {
		$("#invite_dm_button").attr("disabled","disabled");                      
		$("#tweet_msg").html("<img width='20' height='20' src='{%url static 'images/ajax-loader.gif' %}/>Sending Direct Msg Tweets<img width='20' height='20' src='{% url static 'images/ajax-loader.gif' %}' />");
	}
      });
    });
  
});

function refreshAttendee()
{
     var attendee_list = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
     $.getJSON('{% url attendees_list event_id=event.id %}', function(data){
       		$.each(data, function(index, attendee) {
       			attendee_list += '<img src= "'+attendee[0]+'">&nbsp&nbsp&nbsp';
       			if (index % 8==0 && index != 0)
       			{
       				attendee_list +='<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
       			}
     		});
     		$('#attendees_thumbs').html(attendee_list);
   });
}


//default usage
$("#overlay-textarea-twitter").charCount();
		({
			allowed: 80,		
			warning: 20,
		});
$("#overlay-textarea-facebook").charCount();
		({
			allowed: 80,		
			warning: 20,
		});

</script>
<!-- Content ends here -->
{% endblock %}












