{% extends "event_base.html" %}



	{% block  js_css_include %}
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key={{map_key}}" type="text/javascript" > </script>
	{% endblock %}




{% block title  %}
{{event.name}}
{% endblock %}


{% block content %}
<!-- Content starts here -->
<div class="span-12">

{%if user%}

  {% if going %}
      <div class="header notice">
      	<h1>hello {{user.name}}!</h1>
	<div id="header_msg" class="quiet"><font size = 4.5em>You are planning to go to this event.</font></div>
	<BR>
	  
	<input id="not_going_button" type="submit" class="button" value="Can't make it :(" > &nbsp; &nbsp;
	<button href="#" id="invite_button" class="button2" rel="#invite_popup">Invite Friends!</button>
	
	  
      </div>
  {% else %}
      <div class="header notice">
      	<h1>hello {{user.name}}!</h1>
	<div id="header_msg" class="quiet"><font size = 4.5em>you and your friends are 19 points away from a prize</font></div>
	<BR>
	  
	
	<input id="going_button" type="submit" class="button" value="Count me In!"> &nbsp; &nbsp;
	<button href='#' id="invite_button" class="button2" rel="#invite_popup">Tell Friends</button>
      </div>
  {% endif%}
{% else %}
      <div class="header notice">
      	<h1>Hello There!</h1>
	<div id="header_msg" class="quiet"><font size = 4.5em>There are {{event.num_attendees}} attending this event.</font></div>
	<BR>
	  
	<input id="login_button" type="submit" class="button" value="Login: See if your friends are going." onClick="location.href='/login/'"> &nbsp; &nbsp;
      </div>
{% endif%}


<div id="invite_popup" class="simple_overlay">

    <h2>Invite Your Friends!</h2>
    <BR /><BR />
    <div class="twitterfriends">
      <h3>Twitter Friends</h3>
      <div id="twitlist"></div>
    </div>
    
    <BR /><BR /><BR /><BR /><BR /><BR />
    <input type="submit" class="button" value="Invite my friends" />
</div>


<BR />
		
<div class="yourprice">
  {% if going %}
  You Paid:
  {% else %}
  Your Price: 
  {% endif %}

  <font color=#9cb926>${{event.discount_price}}</font></div>
<div class="genprice">General Price: <font color=#ff8a00>${{event.price}}</font></div>
	
<BR /><BR /><BR />

<div class="attending">Attendees <font class="quiet">(<b>{{event.spots_left}}</b> Spots Left out of <b>{{event.capacity}}</b>!)</font></div>
		    
      <div class="attenddees">
{% for attendee in attendees %} 


<a href="#">
<img src="{{attendee.profile_pic}}" /> 
</a>
&nbsp;




{% endfor %}
      </div>

</div>
		
<div class="span-1">&nbsp;</div>		  
<div class="span-11 last">
	      
  <div id="visual_img" style="width: 400px; height: 500px;">
    <img class="center" style="width: 400px; height: 500px;" src="/site_media/images/events/{{event.id}}" />
  </div>

  <div id="visual_map" style="width: 400px; height: 500px;" > </div>						
	      
  <div id="title">
    {{event.name}}
  </div>
  <div id="details">
    {{event.venue}}, {{event.venue_address}}
		

    <a id="show_map" href="#"></a>
    <br />{{event.time}} 
  </div>
</div>





<script>
$(document).ready(function() {

	$('#invite_popup_close').bind('click', function() {
		$('#invite_popup').hide();
		$('#twitlist').html("");
	 });


	$("#not_going_button").click(function(){
		$.get('/ajax/event_not_going/{{event.id}}', function(data) {
			location.reload();
		    });
	    });
			
	$("#going_button").click(function(){
		$.get('/ajax/event_going/{{event.id}}', function(data) {
			location.reload();
		    });
	    });


	$("#invite_button").overlay(
				    {
					expose: {
					    loadSpeed: 200,
						color: 'gray',
						opacity: 0.8
						},
					onLoad: function(event) {
						display_friends_invite();
					}
				    }); 
			
});

$(document).ready(function() {
    
	$("#visual_map").hide();
	$("#show_map").html("(Show Map)");

	if (GBrowserIsCompatible()) {
	    var map = new GMap2(document.getElementById("visual_map"));
	    map.setCenter(new GLatLng(37.4419, -122.1419), 13);
	    map.setUIToDefault();
	}			


	$("#show_map").click(function() {

		if ($("#visual_img").is(":visible")) {

		    $("#visual_img").hide(500);
			
		    $("#visual_map").show(500, function() {
			   
			    if (GBrowserIsCompatible()) {
				var map = new GMap2(document.getElementById("visual_map"));
				map.setCenter(new GLatLng(37.4419, -122.1419), 13);
				map.setUIToDefault();
			    }
			});
		

		    $("#show_map").html("(Hide Map)");
		}else {
		    $("#visual_img").show(500);
		    $("#visual_map").hide(500);
		    $("#show_map").html("(Show Map)");
		}
	    });
    });

function display_friends_invite() {
	    $.getJSON('/ajax/event_friend_not_attendees/{{event.id}}', function(data){
		    $('#twitlist').append(make_friend_list(data));
		});
}
</script>
<!-- Content ends here -->
{% endblock %}












